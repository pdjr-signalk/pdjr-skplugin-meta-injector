"use strict";(self.webpackChunkpdjr_skplugin_metadata=self.webpackChunkpdjr_skplugin_metadata||[]).push([[537],{59:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var l=a(624),r=a.n(l),n=a(264),s=a(239);const c=e=>r().createElement(n.Zb,null,r().createElement(n.Ol,null,"Metadata Configuration"),r().createElement(n.eW,null,r().createElement("div",null,r().createElement("div",{style:{float:"left",width:"49%"}},r().createElement(u,{configuration:e.configuration,save:t=>e.save(t)})),r().createElement("div",{style:{float:"right",width:"49%"}},r().createElement(m,{options:[{value:"chocolate",label:"Chocolate"},{value:"strawberry",label:"Strawberry"},{value:"vanilla",label:"Vanilla"}]}))))),i={lineHeight:"36px"},o=({type:e,fieldName:t,label:a,value:l,setter:s,text:c})=>r().createElement(n.cw,{row:!0},r().createElement(n.JX,{md:"6"},r().createElement(n.__,{style:i,htmlFor:t},a)),r().createElement(n.JX,{md:"6"},"checkbox"==e?r().createElement(n.II,{type:"checkbox",name:t,onChange:e=>s(e.target.checked),checked:l}):"","text"==e?r().createElement(n.II,{type:"text",name:t,onChange:e=>s(e.target.value),value:l}):"",r().createElement(n.R9,{color:"muted"},c))),u=({configuration:e,save:t})=>{const[a,s]=(0,l.useState)(e.resourceType),[c,i]=(0,l.useState)(e.startDelay),[u,m]=(0,l.useState)((()=>e.excludePaths.sort().join(", "))),[d,p]=(0,l.useState)(e.persist);return r().createElement(n.l0,{className:"square rounded border",style:{padding:"5px"}},r().createElement(n.cw,{row:!0,style:{height:"60px"}},r().createElement(n.JX,null,r().createElement(o,{type:"text",fieldName:"resourceType",label:"Metadata resource type",value:a,setter:s,text:""}))),r().createElement(n.cw,{row:!0,style:{height:"300px"}},r().createElement(n.JX,null,r().createElement(o,{type:"text",fieldName:"startDelay",label:"Start delay",value:c,setter:i,text:""}),r().createElement(o,{type:"text",fieldName:"excludePathsString",label:"Exclude paths beginning with",value:u,setter:m,text:""}),r().createElement(o,{type:"checkbox",fieldName:"persist",label:"Persist dynamic changes",value:d,setter:p,text:""}))),r().createElement(n.cw,{row:!0},r().createElement(n.JX,null,r().createElement(n.Si,{style:{justifyContent:"space-between"}},r().createElement(n.Si,null,r().createElement(n.zx,{size:"sm",color:"primary",onClick:e=>{e.preventDefault(),t({resourceType:a,startDelay:c,excludePaths:u.split(/,/).map((e=>e.trim())).sort(),persist:d})}},r().createElement("i",{className:"fa fa-save"})," Save ")," ",r().createElement(n.zx,{size:"sm",color:"primary",onClick:t=>{t.preventDefault(),s(e.resourceType),i(e.startDelay),m(e.excludePaths.sort().join(", ")),p(e.persist)}},r().createElement("i",{className:"fa fa-ban"})," Cancel ")),r().createElement(n.Si,null,r().createElement(n.zx,{size:"sm",color:"danger",onClick:e=>{e.preventDefault(),confirm("Compose will rebuild metadata from configuration files. New metadata entities may be created and existing metadata entities may be updated. Proceed?")&&fetch("/plugins/metadata/compose",{credentials:"include",method:"PUT"}).then((e=>{200!==e.status&&alert("Compose request failed ("+e.status+")")}))}},r().createElement("i",{className:"fa fa-save"})," Compose ")," ",r().createElement(n.zx,{size:"sm",color:"danger",onClick:e=>{e.preventDefault(),confirm("Snaphot will capture live Signal K metadata into the current metadata resource. New metadata entities may be created and existing metadata entities may be updated. Proceed?")&&fetch("/plugins/metadata/snapshot",{credentials:"include",method:"PUT"}).then((e=>{200!==e.status&&alert("Snapshot request failed ("+e.status+")")}))}},r().createElement("i",{className:"fa fa-save"})," Snapshot "))))))},m=()=>{const e={metadata:"/plugins/metadata/keys",config:"/plugins/metadata/keys",paths:"/plugins/metadata/paths"},[t,a]=(0,l.useState)("metadata"),[c,i]=(0,l.useState)(null),[o,u]=(0,l.useState)(null),[m,d]=(0,l.useState)(!0),[p,h]=(0,l.useState)(!0),[f,v]=(0,l.useState)(!0),E=e=>{a(e),i(null),y(null)},y=e=>{u(e||""),d(null===e||"paths"===t),h(null===e),v(null===e||"paths"===t)};return r().createElement(n.l0,{className:"square rounded border",style:{padding:"5px"}},r().createElement(n.cw,null,r().createElement(n.cw,{row:!0,style:{height:"60px"}},r().createElement(n.JX,null,r().createElement(s.ZP,{name:"selectItem",controlShouldRenderValue:!0,loadOptions:(a,l)=>{i(null),fetch(e[t],{credentials:"include"}).then((e=>e.json())).then((e=>{switch(t){case"metadata":l(e.keys.filter((e=>!e.startsWith("."))).map((e=>({value:e,label:e}))));break;case"config":l(e.keys.filter((e=>e.startsWith("."))).map((e=>({value:e,label:e}))));break;case"paths":l(e.keys.map((e=>({value:e,label:e}))))}}))},defaultOptions:!0,key:JSON.stringify(t),value:c,onChange:a=>{i(a),d(!0),h(!0),v(!0),null!=a&&fetch(e[t]+"/"+a.value,{credentials:"include"}).then((e=>{e.json().then((e=>{delete e.value.timestamp,delete e.value.$source,y(JSON.stringify(e.value,null,2))})).catch((e=>{alert("The metadata value for '"+e.value+"' is not valid JSON")}))})).catch((e=>{alert("The metadata value for '"+e.value+"' could not be retrieved")}))}}),r().createElement("div",{class:"scope-buttons"},r().createElement("label",null,r().createElement("input",{type:"radio",name:"selectScope",value:"metadata",checked:"metadata"===t,onChange:e=>E(e.target.value)})," metadata "),"    ",r().createElement("label",null,r().createElement("input",{type:"radio",name:"selectScope",value:"config",checked:"config"===t,onChange:e=>E(e.target.value)})," config "),"    ",r().createElement("label",null,r().createElement("input",{type:"radio",name:"selectScope",value:"paths",checked:"paths"===t,onChange:e=>E(e.target.value)})," paths "),"    "))),r().createElement(n.cw,{row:!0,style:{height:"300px"}},r().createElement(n.JX,null,r().createElement("textarea",{name:"metadata",rows:"12",wrap:"off",style:{width:"100%"},value:o,onChange:e=>y(e.value)}))),r().createElement(n.cw,{row:!0},r().createElement(n.JX,null,r().createElement(n.Si,{style:{justifyContent:"space-between"}},r().createElement(n.Si,null,r().createElement(n.zx,{name:"save",size:"sm",color:"primary",disabled:m,onClick:e=>{e.preventDefault(),(()=>{try{var[e,t]=((e,t)=>{var a,l;if(console.log("validating %s %s",e,t),null!==e){if((a=e.trim()).length>0){if(t){l=t.trim();try{l=JSON.parse(l)}catch(e){throw new Error("matadata value is not valid JSON")}if("object"==typeof l)return[a,JSON.stringify(l)];throw new Error("metadata value is not a JSON object")}throw new Error("metadata value is null")}throw new Error("key is blank")}throw new Error("key is null")})(c?c.value:null,o);fetch("/plugins/metadata/keys/"+e,{credentials:"include",method:"PUT",headers:{"Content-type":"application/json"},body:t}).then((e=>{if(200!=e.status)throw new Error("Server rejected save request (Error "+e.status+")")}))}catch(e){alert(e.message)}})()}},r().createElement("i",{className:"fa fa-save"})," Save ")," ",r().createElement(n.zx,{name:"saveAs",size:"sm",color:"primary",disabled:p,onClick:e=>{e.preventDefault(),(()=>{try{if(e=prompt("Enter name of new metadata key")){var[e,t]=validateMetadata(e,o);fetch("/plugins/metadata/keys/"+e,{credentials:"include",method:"PUT",headers:{"Content-type":"application/json"},body:t}).then((e=>{if(200!=e.status)throw new Error("Server rejected save request (Error "+e.status+")")}))}}catch(e){alert(e.message)}})()}},r().createElement("i",{className:"fa fa-save"})," Save As ")," "),r().createElement(n.Si,null,r().createElement(n.zx,{name:"delete",size:"sm",color:"danger",disabled:f,onClick:e=>{e.preventDefault(),(()=>{try{var e=c?c.value:null;if(null===e)throw new Error("invalid key value");confirm("Really delete metadata for "+e)&&fetch("/plugins/metadata/keys/"+e,{credentials:"include",method:"PUT",headers:{"Content-type":"application/json"},body:null}).then((e=>{if(console.log("::::"),200!=e.status)throw new Error("Server rejected delete request (Error "+e.status+")");var l=t;a(null),a(l),y(null)}))}catch(e){alert(e.message)}})()}},r().createElement("i",{className:"fa fa-ban"})," Delete ")))))))}}}]);